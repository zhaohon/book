# å”åƒ§å¨å¨é¡¹ç›®äºŒå¼€å­¦ä¹ æŒ‡å—

## ğŸ“š é¡¹ç›®æ¶æ„æ¦‚è§ˆ

è¿™æ˜¯ä¸€ä¸ª **Monorepoï¼ˆå•ä»“åº“å¤šåŒ…ï¼‰** æ¶æ„çš„å³æ—¶é€šè®¯ï¼ˆIMï¼‰é¡¹ç›®ï¼Œä½¿ç”¨ **TypeScript + React** å¼€å‘ã€‚

### æ ¸å¿ƒæ¦‚å¿µ

```
é¡¹ç›®æ ¹ç›®å½•
â”œâ”€â”€ apps/          # åº”ç”¨å±‚ï¼ˆä¸»åº”ç”¨ï¼‰
â”‚   â””â”€â”€ web/       # Web/Electron ä¸»åº”ç”¨å…¥å£
â”œâ”€â”€ packages/      # åŒ…å±‚ï¼ˆå…±äº«æ¨¡å—ï¼‰
â”‚   â”œâ”€â”€ tsdaodaobase/      # åŸºç¡€æ ¸å¿ƒåŒ…ï¼ˆæœ€é‡è¦ï¼ï¼‰
â”‚   â”œâ”€â”€ tsdaodaologin/     # ç™»å½•æ¨¡å—
â”‚   â”œâ”€â”€ tsdaodaocontacts/  # é€šè®¯å½•æ¨¡å—
â”‚   â””â”€â”€ tsdaodaodatasource/# æ•°æ®æºæ¨¡å—
â””â”€â”€ package.json   # æ ¹é…ç½®ï¼ˆç®¡ç†æ‰€æœ‰å­åŒ…ï¼‰
```

---

## ğŸ¯ ç¬¬ä¸€æ­¥ï¼šç†è§£ç›®å½•ç»“æ„

### 1. **apps/web** - ä¸»åº”ç”¨å…¥å£ï¼ˆä»è¿™é‡Œå¼€å§‹ï¼ï¼‰

è¿™æ˜¯æ•´ä¸ªåº”ç”¨çš„**å¯åŠ¨å…¥å£**ï¼Œè´Ÿè´£ï¼š
- åˆå§‹åŒ–åº”ç”¨
- æ³¨å†Œå„ä¸ªæ¨¡å—
- é…ç½®è·¯ç”±å’Œèœå•

**å…³é”®æ–‡ä»¶ï¼š**
- `src/index.tsx` - **åº”ç”¨å¯åŠ¨å…¥å£**ï¼ˆæœ€é‡è¦ï¼ï¼‰
- `src/App/index.tsx` - åº”ç”¨ä¸»ç»„ä»¶
- `src/Layout/index.tsx` - å¸ƒå±€ç»„ä»¶
- `src/Pages/Main/` - ä¸»é¡µé¢

**å­¦ä¹ è·¯å¾„ï¼š**
1. å…ˆçœ‹ `apps/web/src/index.tsx` - ç†è§£åº”ç”¨å¦‚ä½•å¯åŠ¨
2. å†çœ‹ `apps/web/src/App/index.tsx` - ç†è§£èœå•å’Œè·¯ç”±æ³¨å†Œ
3. æœ€åçœ‹ `apps/web/src/Layout/index.tsx` - ç†è§£é¡µé¢å¸ƒå±€

### 2. **packages/tsdaodaobase** - æ ¸å¿ƒåŸºç¡€åŒ…ï¼ˆæ ¸å¿ƒï¼ï¼‰

è¿™æ˜¯**æœ€æ ¸å¿ƒçš„åŒ…**ï¼ŒåŒ…å«ï¼š
- `WKApp` - å…¨å±€åº”ç”¨å¯¹è±¡ï¼ˆç±»ä¼¼ Vue çš„ Vue å®ä¾‹ï¼‰
- æ‰€æœ‰åŸºç¡€ç»„ä»¶ï¼ˆèŠå¤©ã€æ¶ˆæ¯ã€ä¼šè¯ç­‰ï¼‰
- è·¯ç”±ç®¡ç†ã€èœå•ç®¡ç†ã€API å®¢æˆ·ç«¯
- æ¶ˆæ¯å¤„ç†ã€æ•°æ®æºç®¡ç†

**å…³é”®ç›®å½•ï¼š**
```
packages/tsdaodaobase/src/
â”œâ”€â”€ App.tsx              # WKApp æ ¸å¿ƒç±»ï¼ˆå…¨å±€å•ä¾‹ï¼‰
â”œâ”€â”€ Components/          # æ‰€æœ‰åŸºç¡€ç»„ä»¶
â”‚   â”œâ”€â”€ Conversation/    # ä¼šè¯åˆ—è¡¨
â”‚   â”œâ”€â”€ MessageInput/    # æ¶ˆæ¯è¾“å…¥æ¡†
â”‚   â”œâ”€â”€ WKLayout/       # å¸ƒå±€ç»„ä»¶
â”‚   â””â”€â”€ ...             # å…¶ä»–ç»„ä»¶
â”œâ”€â”€ Pages/
â”‚   â””â”€â”€ Chat/           # èŠå¤©é¡µé¢
â”œâ”€â”€ Messages/            # å„ç§æ¶ˆæ¯ç±»å‹ç»„ä»¶
â”œâ”€â”€ Service/             # æœåŠ¡å±‚
â”‚   â”œâ”€â”€ Route.ts         # è·¯ç”±ç®¡ç†
â”‚   â”œâ”€â”€ Menus.ts         # èœå•ç®¡ç†
â”‚   â”œâ”€â”€ APIClient.ts     # API å®¢æˆ·ç«¯
â”‚   â””â”€â”€ ...
â””â”€â”€ module.tsx           # BaseModule æ¨¡å—å®šä¹‰
```

### 3. **packages/tsdaodaologin** - ç™»å½•æ¨¡å—

è´Ÿè´£ç™»å½•ç›¸å…³çš„ UI å’Œé€»è¾‘ã€‚

### 4. **packages/tsdaodaocontacts** - é€šè®¯å½•æ¨¡å—

è´Ÿè´£è”ç³»äººã€å¥½å‹ç”³è¯·ç­‰åŠŸèƒ½ã€‚

### 5. **packages/tsdaodaodatasource** - æ•°æ®æºæ¨¡å—

è´Ÿè´£æ•°æ®è·å–å’ŒåŒæ­¥ã€‚

---

## ğŸš€ ç¬¬äºŒæ­¥ï¼šç†è§£æ ¸å¿ƒæ¦‚å¿µ

### 1. **WKApp** - å…¨å±€åº”ç”¨å¯¹è±¡

`WKApp` æ˜¯æ•´ä¸ªåº”ç”¨çš„**æ ¸å¿ƒå•ä¾‹å¯¹è±¡**ï¼Œç±»ä¼¼äºï¼š
- Vue çš„ `Vue` å®ä¾‹
- React Context çš„å…¨å±€çŠ¶æ€
- æ‰€æœ‰åŠŸèƒ½éƒ½é€šè¿‡ `WKApp` è®¿é—®

**å¸¸ç”¨ APIï¼š**
```typescript
WKApp.shared              // åº”ç”¨å®ä¾‹
WKApp.route               // è·¯ç”±ç®¡ç†
WKApp.menus               // èœå•ç®¡ç†
WKApp.apiClient           // API å®¢æˆ·ç«¯
WKApp.loginInfo           // ç™»å½•ä¿¡æ¯
WKApp.dataSource          // æ•°æ®æº
WKApp.messageManager      // æ¶ˆæ¯ç®¡ç†
```

### 2. **æ¨¡å—ç³»ç»Ÿï¼ˆModule Systemï¼‰**

é¡¹ç›®é‡‡ç”¨**æ¨¡å—åŒ–æ¶æ„**ï¼Œæ¯ä¸ªåŠŸèƒ½éƒ½æ˜¯ä¸€ä¸ªæ¨¡å—ï¼š

```typescript
// åœ¨ apps/web/src/index.tsx ä¸­æ³¨å†Œæ¨¡å—
WKApp.shared.registerModule(new BaseModule());      // åŸºç¡€æ¨¡å—
WKApp.shared.registerModule(new LoginModule());      // ç™»å½•æ¨¡å—
WKApp.shared.registerModule(new ContactsModule());   // é€šè®¯å½•æ¨¡å—
```

æ¯ä¸ªæ¨¡å—å®ç° `IModule` æ¥å£ï¼Œåœ¨ `init()` æ–¹æ³•ä¸­æ³¨å†Œè‡ªå·±çš„åŠŸèƒ½ã€‚

### 3. **è·¯ç”±ç³»ç»Ÿ**

é¡¹ç›®æœ‰ä¸¤å¥—è·¯ç”±ï¼š
- **ä¸»è·¯ç”±** (`WKApp.route`) - å·¦ä¾§ä¸»é¡µé¢è·¯ç”±
- **ä¸Šä¸‹æ–‡è·¯ç”±** (`WKApp.routeLeft` / `WKApp.routeRight`) - å·¦å³ä¾§é¢æ¿è·¯ç”±

```typescript
// æ³¨å†Œè·¯ç”±
WKApp.route.register("/", () => <ChatPage />)
WKApp.route.register("/contacts", () => <ContactsList />)
```

### 4. **èœå•ç³»ç»Ÿ**

åº•éƒ¨èœå•é€šè¿‡ `WKApp.menus` ç®¡ç†ï¼š

```typescript
WKApp.menus.register("chat", (context) => {
  const m = new Menus("chat", "/", "ä¼šè¯", icon, selectedIcon)
  m.badge = unreadCount  // æœªè¯»æ¶ˆæ¯æ•°
  return m
}, 1000)  // ä¼˜å…ˆçº§
```

### 5. **Endpoint ç³»ç»Ÿ**

ç”¨äºæ¨¡å—é—´é€šä¿¡å’ŒåŠŸèƒ½æ‰©å±•ï¼š

```typescript
// æ³¨å†Œç«¯ç‚¹
WKApp.endpointManager.setMethod("menus.friendapply.change", () => {
  WKApp.menus.refresh()
}, {
  category: EndpointCategory.friendApplyDataChange,
})
```

---

## ğŸ“– ç¬¬ä¸‰æ­¥ï¼šå­¦ä¹ è·¯å¾„ï¼ˆæŒ‰é¡ºåºï¼‰

### é˜¶æ®µä¸€ï¼šç†è§£å¯åŠ¨æµç¨‹ï¼ˆ1-2å¤©ï¼‰

1. **é˜…è¯»å¯åŠ¨æ–‡ä»¶**
   - `apps/web/src/index.tsx` - çœ‹åº”ç”¨å¦‚ä½•åˆå§‹åŒ–
   - `apps/web/src/App/index.tsx` - çœ‹èœå•å’Œè·¯ç”±å¦‚ä½•æ³¨å†Œ
   - `packages/tsdaodaobase/src/App.tsx` - çœ‹ WKApp çš„æ ¸å¿ƒåŠŸèƒ½

2. **è¿è¡Œé¡¹ç›®**
   ```bash
   yarn install        # å®‰è£…ä¾èµ–
   yarn dev            # å¯åŠ¨å¼€å‘æœåŠ¡å™¨
   ```
   åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼Œè§‚å¯Ÿåº”ç”¨å¯åŠ¨è¿‡ç¨‹ã€‚

### é˜¶æ®µäºŒï¼šç†è§£æ ¸å¿ƒç»„ä»¶ï¼ˆ3-5å¤©ï¼‰

1. **å¸ƒå±€ç³»ç»Ÿ**
   - `packages/tsdaodaobase/src/Components/WKLayout/` - ä¸»å¸ƒå±€
   - `apps/web/src/Layout/index.tsx` - åº”ç”¨å¸ƒå±€
   - `apps/web/src/Pages/Main/` - ä¸»é¡µé¢

2. **èŠå¤©ç›¸å…³**
   - `packages/tsdaodaobase/src/Pages/Chat/` - èŠå¤©é¡µé¢
   - `packages/tsdaodaobase/src/Components/Conversation/` - ä¼šè¯åˆ—è¡¨
   - `packages/tsdaodaobase/src/Components/MessageInput/` - æ¶ˆæ¯è¾“å…¥

3. **æ¶ˆæ¯ç±»å‹**
   - `packages/tsdaodaobase/src/Messages/` - å„ç§æ¶ˆæ¯ç»„ä»¶
     - `Text/` - æ–‡æœ¬æ¶ˆæ¯
     - `Image/` - å›¾ç‰‡æ¶ˆæ¯
     - `Voice/` - è¯­éŸ³æ¶ˆæ¯
     - `Video/` - è§†é¢‘æ¶ˆæ¯
     - ç­‰ç­‰...

### é˜¶æ®µä¸‰ï¼šç†è§£æ•°æ®æµï¼ˆ3-5å¤©ï¼‰

1. **API è°ƒç”¨**
   - `packages/tsdaodaobase/src/Service/APIClient.ts` - API å®¢æˆ·ç«¯
   - å­¦ä¹ å¦‚ä½•è°ƒç”¨åç«¯æ¥å£

2. **æ•°æ®æº**
   - `packages/tsdaodaodatasource/src/` - æ•°æ®æºæ¨¡å—
   - `packages/tsdaodaobase/src/Service/DataSource/` - æ•°æ®æºæœåŠ¡

3. **æ¶ˆæ¯å¤„ç†**
   - `packages/tsdaodaobase/src/Service/MessageManager.ts` - æ¶ˆæ¯ç®¡ç†
   - ç†è§£æ¶ˆæ¯å¦‚ä½•æ¥æ”¶ã€å­˜å‚¨ã€æ˜¾ç¤º

### é˜¶æ®µå››ï¼šå®è·µå¼€å‘ï¼ˆæŒç»­ï¼‰

1. **ä¿®æ”¹ç°æœ‰åŠŸèƒ½**
   - ä¿®æ”¹æ¶ˆæ¯æ ·å¼
   - æ·»åŠ æ–°çš„æ¶ˆæ¯ç±»å‹
   - ä¿®æ”¹èŠå¤©ç•Œé¢

2. **æ·»åŠ æ–°åŠŸèƒ½**
   - åˆ›å»ºæ–°ç»„ä»¶
   - æ³¨å†Œæ–°è·¯ç”±
   - æ·»åŠ æ–°èœå•é¡¹

---

## ğŸ”§ ç¬¬å››æ­¥ï¼šå¸¸è§å¼€å‘åœºæ™¯

### åœºæ™¯1ï¼šæ·»åŠ ä¸€ä¸ªæ–°çš„èœå•é¡¹

```typescript
// åœ¨ apps/web/src/App/index.tsx ä¸­
WKApp.menus.register("my-feature", (context) => {
  const m = new Menus(
    "my-feature",
    "/my-feature",
    "æˆ‘çš„åŠŸèƒ½",
    <img src={icon} />,
    <img src={selectedIcon} />
  )
  return m
}, 5000)

// æ³¨å†Œè·¯ç”±
WKApp.route.register("/my-feature", () => {
  return <MyFeaturePage />
})
```

### åœºæ™¯2ï¼šæ·»åŠ ä¸€ä¸ªæ–°çš„æ¶ˆæ¯ç±»å‹

1. åœ¨ `packages/tsdaodaobase/src/Messages/` ä¸‹åˆ›å»ºæ–°ç›®å½•
2. åˆ›å»ºæ¶ˆæ¯ç»„ä»¶
3. åœ¨æ¶ˆæ¯æ¸²æŸ“å™¨ä¸­æ³¨å†Œ

### åœºæ™¯3ï¼šä¿®æ”¹èŠå¤©ç•Œé¢æ ·å¼

- ä¿®æ”¹ `packages/tsdaodaobase/src/Pages/Chat/index.css`
- ä¿®æ”¹ `packages/tsdaodaobase/src/Pages/Chat/index.tsx`

### åœºæ™¯4ï¼šæ·»åŠ æ–°çš„ API è°ƒç”¨

```typescript
// ä½¿ç”¨ WKApp.apiClient
WKApp.apiClient.get("/api/path")      // GET è¯·æ±‚
WKApp.apiClient.post("/api/path", data) // POST è¯·æ±‚
```

---

## ğŸ“ ç¬¬äº”æ­¥ï¼šæ¨èå­¦ä¹ é¡ºåº

### ç¬¬1å‘¨ï¼šåŸºç¡€ç†è§£
- [ ] ç†è§£ Monorepo æ¶æ„
- [ ] ç†è§£æ¨¡å—ç³»ç»Ÿ
- [ ] ç†è§£ WKApp æ ¸å¿ƒå¯¹è±¡
- [ ] è¿è¡Œé¡¹ç›®å¹¶è§‚å¯Ÿ

### ç¬¬2å‘¨ï¼šç»„ä»¶å­¦ä¹ 
- [ ] å­¦ä¹ å¸ƒå±€ç»„ä»¶
- [ ] å­¦ä¹ èŠå¤©ç»„ä»¶
- [ ] å­¦ä¹ æ¶ˆæ¯ç»„ä»¶
- [ ] å­¦ä¹ è·¯ç”±å’Œèœå•

### ç¬¬3å‘¨ï¼šæ•°æ®æµå­¦ä¹ 
- [ ] å­¦ä¹  API è°ƒç”¨
- [ ] å­¦ä¹ æ•°æ®æº
- [ ] å­¦ä¹ æ¶ˆæ¯å¤„ç†æµç¨‹

### ç¬¬4å‘¨ï¼šå®è·µå¼€å‘
- [ ] ä¿®æ”¹ç°æœ‰åŠŸèƒ½
- [ ] æ·»åŠ å°åŠŸèƒ½
- [ ] ç†è§£é¡¹ç›®ä¸šåŠ¡é€»è¾‘

---

## ğŸ“ å…³é”®æ–‡ä»¶é€ŸæŸ¥è¡¨

| æ–‡ä»¶è·¯å¾„ | ä½œç”¨ | ä¼˜å…ˆçº§ |
|---------|------|--------|
| `apps/web/src/index.tsx` | åº”ç”¨å¯åŠ¨å…¥å£ | â­â­â­â­â­ |
| `packages/tsdaodaobase/src/App.tsx` | WKApp æ ¸å¿ƒç±» | â­â­â­â­â­ |
| `apps/web/src/App/index.tsx` | èœå•å’Œè·¯ç”±æ³¨å†Œ | â­â­â­â­ |
| `packages/tsdaodaobase/src/Pages/Chat/` | èŠå¤©é¡µé¢ | â­â­â­â­ |
| `packages/tsdaodaobase/src/Components/Conversation/` | ä¼šè¯åˆ—è¡¨ | â­â­â­â­ |
| `packages/tsdaodaobase/src/Service/Route.ts` | è·¯ç”±ç®¡ç† | â­â­â­ |
| `packages/tsdaodaobase/src/Service/Menus.ts` | èœå•ç®¡ç† | â­â­â­ |
| `packages/tsdaodaobase/src/Service/APIClient.ts` | API å®¢æˆ·ç«¯ | â­â­â­ |

---

## ğŸ’¡ å­¦ä¹ å»ºè®®

1. **ä¸è¦ä¸€å¼€å§‹å°±çœ‹æ‰€æœ‰ä»£ç ** - æŒ‰å­¦ä¹ è·¯å¾„å¾ªåºæ¸è¿›
2. **å¤šè¿è¡Œé¡¹ç›®** - ä¿®æ”¹ä»£ç åç«‹å³çœ‹æ•ˆæœ
3. **ä½¿ç”¨æµè§ˆå™¨è°ƒè¯•å·¥å…·** - æ‰“æ–­ç‚¹ã€çœ‹ç½‘ç»œè¯·æ±‚
4. **é˜…è¯»æ³¨é‡Š** - ä»£ç ä¸­çš„æ³¨é‡Šå¾ˆæœ‰å¸®åŠ©
5. **ä»ç®€å•åŠŸèƒ½å¼€å§‹** - å…ˆæ”¹æ ·å¼ï¼Œå†æ”¹é€»è¾‘ï¼Œæœ€ååŠ åŠŸèƒ½

---

## ğŸ› å¸¸è§é—®é¢˜

### Q: å¦‚ä½•ä¿®æ”¹ API åœ°å€ï¼Ÿ
A: åœ¨ `apps/web/src/index.tsx` ä¸­ä¿®æ”¹ `apiURL` å˜é‡

### Q: å¦‚ä½•æ·»åŠ æ–°çš„é¡µé¢ï¼Ÿ
A: 
1. åˆ›å»ºé¡µé¢ç»„ä»¶
2. åœ¨ `apps/web/src/App/index.tsx` ä¸­æ³¨å†Œè·¯ç”±
3. å¯é€‰ï¼šæ·»åŠ èœå•é¡¹

### Q: å¦‚ä½•ä¿®æ”¹ä¸»é¢˜é¢œè‰²ï¼Ÿ
A: åœ¨ `packages/tsdaodaobase/src/App.tsx` çš„ `WKConfig` ç±»ä¸­ä¿®æ”¹ `themeColor`

### Q: å¦‚ä½•è°ƒè¯•ï¼Ÿ
A: 
- ä½¿ç”¨ `console.log` è¾“å‡ºæ—¥å¿—
- ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·
- ä½¿ç”¨ React DevTools

---

## ğŸ“š ç›¸å…³æŠ€æœ¯æ ˆ

- **React 17** - UI æ¡†æ¶
- **TypeScript** - ç±»å‹ç³»ç»Ÿ
- **Webpack** - æ‰“åŒ…å·¥å…·
- **Electron** - æ¡Œé¢åº”ç”¨
- **Turbo** - Monorepo æ„å»ºå·¥å…·
- **Yarn Workspaces** - åŒ…ç®¡ç†

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. âœ… é˜…è¯»æœ¬æ–‡æ¡£
2. âœ… è¿è¡Œ `yarn install && yarn dev`
3. âœ… æ‰“å¼€ `apps/web/src/index.tsx` å¼€å§‹å­¦ä¹ 
4. âœ… æŒ‰ç…§å­¦ä¹ è·¯å¾„é€æ­¥æ·±å…¥

**è®°ä½ï¼šä¸è¦æ€¥äºæ±‚æˆï¼Œä¸€æ­¥ä¸€æ­¥æ¥ï¼** ğŸš€

