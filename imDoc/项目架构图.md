# é¡¹ç›®æ¶æ„å›¾

## ğŸ—ï¸ æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     é¡¹ç›®æ ¹ç›®å½• (Monorepo)                    â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚   apps/web/      â”‚         â”‚   packages/      â”‚          â”‚
â”‚  â”‚   (ä¸»åº”ç”¨)       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤   (åŠŸèƒ½æ¨¡å—)     â”‚          â”‚
â”‚  â”‚                  â”‚  ä¾èµ–    â”‚                  â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚         â”‚                              â”‚                    â”‚
â”‚         â”‚                              â”‚                    â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                        â”‚                                    â”‚
â”‚                 â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚                 â”‚ package.json â”‚                            â”‚
â”‚                 â”‚  (æ ¹é…ç½®)    â”‚                            â”‚
â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ åŒ…ä¾èµ–å…³ç³»

```
apps/web (ä¸»åº”ç”¨)
    â”‚
    â”œâ”€â”€â–º @tsdaodao/base (æ ¸å¿ƒåŒ…) â­
    â”‚       â”œâ”€â”€ WKApp å…¨å±€å¯¹è±¡
    â”‚       â”œâ”€â”€ æ‰€æœ‰åŸºç¡€ç»„ä»¶
    â”‚       â”œâ”€â”€ è·¯ç”±/èœå•ç®¡ç†
    â”‚       â””â”€â”€ API å®¢æˆ·ç«¯
    â”‚
    â”œâ”€â”€â–º @tsdaodao/login (ç™»å½•æ¨¡å—)
    â”‚       â””â”€â”€ ç™»å½•é¡µé¢å’Œé€»è¾‘
    â”‚
    â”œâ”€â”€â–º @tsdaodao/contacts (é€šè®¯å½•æ¨¡å—)
    â”‚       â””â”€â”€ è”ç³»äººç›¸å…³åŠŸèƒ½
    â”‚
    â””â”€â”€â–º @tsdaodao/datasource (æ•°æ®æºæ¨¡å—)
            â””â”€â”€ æ•°æ®è·å–å’ŒåŒæ­¥
```

---

## ğŸš€ åº”ç”¨å¯åŠ¨æµç¨‹

```
1. apps/web/src/index.tsx (å…¥å£)
   â”‚
   â”œâ”€â–º é…ç½® API åœ°å€
   â”‚
   â”œâ”€â–º æ³¨å†Œæ¨¡å—
   â”‚   â”œâ”€â–º BaseModule (åŸºç¡€æ¨¡å—)
   â”‚   â”œâ”€â–º LoginModule (ç™»å½•æ¨¡å—)
   â”‚   â”œâ”€â–º ContactsModule (é€šè®¯å½•æ¨¡å—)
   â”‚   â””â”€â–º DataSourceModule (æ•°æ®æºæ¨¡å—)
   â”‚
   â”œâ”€â–º WKApp.shared.startup() (å¯åŠ¨åº”ç”¨)
   â”‚
   â””â”€â–º ReactDOM.render(<App />) (æ¸²æŸ“åº”ç”¨)
       â”‚
       â””â”€â–º apps/web/src/App/index.tsx
           â”‚
           â”œâ”€â–º æ³¨å†Œèœå• (WKApp.menus.register)
           â”‚
           â”œâ”€â–º æ³¨å†Œè·¯ç”± (WKApp.route.register)
           â”‚
           â””â”€â–º æ¸²æŸ“ Layout
               â”‚
               â””â”€â–º apps/web/src/Layout/index.tsx
                   â”‚
                   â””â”€â–º apps/web/src/Pages/Main/
                       â”‚
                       â””â”€â–º æ˜¾ç¤ºä¸»ç•Œé¢
```

---

## ğŸ¨ é¡µé¢æ¸²æŸ“æµç¨‹

```
ç”¨æˆ·è®¿é—®é¡µé¢
    â”‚
    â–¼
WKApp.route.get("/path")  (è·å–è·¯ç”±ç»„ä»¶)
    â”‚
    â–¼
apps/web/src/Pages/Main/index.tsx
    â”‚
    â”œâ”€â–º WKLayout (å¸ƒå±€ç»„ä»¶)
    â”‚   â”‚
    â”‚   â”œâ”€â–º contentLeft (å·¦ä¾§å†…å®¹)
    â”‚   â”‚   â””â”€â–º MainContentLeft
    â”‚   â”‚       â””â”€â–º æ ¹æ®è·¯ç”±æ¸²æŸ“å¯¹åº”é¡µé¢
    â”‚   â”‚
    â”‚   â”œâ”€â–º contentRight (å³ä¾§å†…å®¹)
    â”‚   â”‚   â””â”€â–º èŠå¤©å†…å®¹åŒºåŸŸ
    â”‚   â”‚
    â”‚   â””â”€â–º onRenderTab (åº•éƒ¨æ ‡ç­¾)
    â”‚       â””â”€â–º TabNormalScreen (èœå•æ )
    â”‚
    â””â”€â–º æ˜¾ç¤ºå®Œæ•´ç•Œé¢
```

---

## ğŸ”„ æ•°æ®æµ

```
ç”¨æˆ·æ“ä½œ
    â”‚
    â–¼
UI ç»„ä»¶ (React Component)
    â”‚
    â–¼
WKApp.apiClient.get/post/... (API è°ƒç”¨)
    â”‚
    â–¼
åç«¯æœåŠ¡å™¨
    â”‚
    â–¼
è¿”å›æ•°æ®
    â”‚
    â–¼
æ›´æ–° WKApp çŠ¶æ€
    â”‚
    â–¼
è§¦å‘ UI æ›´æ–° (React é‡æ–°æ¸²æŸ“)
```

---

## ğŸ“± ç»„ä»¶å±‚æ¬¡ç»“æ„

```
App (apps/web/src/App/index.tsx)
    â”‚
    â””â”€â–º AppLayout (apps/web/src/Layout/index.tsx)
            â”‚
            â””â”€â–º MainPage (apps/web/src/Pages/Main/index.tsx)
                    â”‚
                    â””â”€â–º WKLayout (packages/tsdaodaobase/src/Components/WKLayout/)
                            â”‚
                            â”œâ”€â–º TabNormalScreen (åº•éƒ¨èœå•)
                            â”‚
                            â”œâ”€â–º MainContentLeft (å·¦ä¾§å†…å®¹)
                            â”‚   â””â”€â–º æ ¹æ®è·¯ç”±æ˜¾ç¤ºä¸åŒé¡µé¢
                            â”‚       â”œâ”€â–º ChatPage (èŠå¤©é¡µé¢)
                            â”‚       â”œâ”€â–º ContactsList (é€šè®¯å½•)
                            â”‚       â””â”€â–º ...
                            â”‚
                            â””â”€â–º contentRight (å³ä¾§å†…å®¹)
                                â””â”€â–º èŠå¤©è¯¦æƒ…/å…¶ä»–å†…å®¹
```

---

## ğŸ§© æ¨¡å—ç³»ç»Ÿ

```
WKApp.shared.registerModule()
    â”‚
    â”œâ”€â–º BaseModule
    â”‚   â””â”€â–º init() æ–¹æ³•ä¸­æ³¨å†Œï¼š
    â”‚       â”œâ”€â–º è·¯ç”±ç«¯ç‚¹
    â”‚       â”œâ”€â–º èœå•ç«¯ç‚¹
    â”‚       â”œâ”€â–º æ¶ˆæ¯å¤„ç†å™¨
    â”‚       â””â”€â–º å…¶ä»–åŠŸèƒ½
    â”‚
    â”œâ”€â–º LoginModule
    â”‚   â””â”€â–º init() æ–¹æ³•ä¸­æ³¨å†Œï¼š
    â”‚       â””â”€â–º ç™»å½•è·¯ç”±
    â”‚
    â”œâ”€â–º ContactsModule
    â”‚   â””â”€â–º init() æ–¹æ³•ä¸­æ³¨å†Œï¼š
    â”‚       â””â”€â–º é€šè®¯å½•ç›¸å…³åŠŸèƒ½
    â”‚
    â””â”€â–º DataSourceModule
        â””â”€â–º init() æ–¹æ³•ä¸­æ³¨å†Œï¼š
            â””â”€â–º æ•°æ®æºæä¾›è€…
```

---

## ğŸ—‚ï¸ æ–‡ä»¶ç»„ç»‡æ–¹å¼

```
packages/tsdaodaobase/src/
â”‚
â”œâ”€â”€ App.tsx                    # WKApp æ ¸å¿ƒç±»
â”‚
â”œâ”€â”€ Components/                # ç»„ä»¶ç›®å½•
â”‚   â”œâ”€â”€ Conversation/          # ä¼šè¯åˆ—è¡¨ç»„ä»¶
â”‚   â”œâ”€â”€ MessageInput/          # æ¶ˆæ¯è¾“å…¥ç»„ä»¶
â”‚   â”œâ”€â”€ WKLayout/             # å¸ƒå±€ç»„ä»¶
â”‚   â””â”€â”€ ...                    # å…¶ä»–ç»„ä»¶
â”‚
â”œâ”€â”€ Pages/                     # é¡µé¢ç›®å½•
â”‚   â””â”€â”€ Chat/                  # èŠå¤©é¡µé¢
â”‚
â”œâ”€â”€ Messages/                  # æ¶ˆæ¯ç±»å‹
â”‚   â”œâ”€â”€ Text/                 # æ–‡æœ¬æ¶ˆæ¯
â”‚   â”œâ”€â”€ Image/                # å›¾ç‰‡æ¶ˆæ¯
â”‚   â”œâ”€â”€ Voice/                # è¯­éŸ³æ¶ˆæ¯
â”‚   â””â”€â”€ ...                   # å…¶ä»–æ¶ˆæ¯ç±»å‹
â”‚
â”œâ”€â”€ Service/                   # æœåŠ¡å±‚
â”‚   â”œâ”€â”€ Route.ts              # è·¯ç”±ç®¡ç†
â”‚   â”œâ”€â”€ Menus.ts              # èœå•ç®¡ç†
â”‚   â”œâ”€â”€ APIClient.ts          # API å®¢æˆ·ç«¯
â”‚   â””â”€â”€ ...                   # å…¶ä»–æœåŠ¡
â”‚
â””â”€â”€ module.tsx                # BaseModule å®šä¹‰
```

---

## ğŸ”Œ æ‰©å±•ç‚¹ç³»ç»Ÿ

```
WKApp.endpointManager
    â”‚
    â”œâ”€â–º EndpointCategory.chatMenusPopover
    â”‚   â””â”€â–º èŠå¤©èœå•æ‰©å±•ç‚¹
    â”‚
    â”œâ”€â–º EndpointCategory.channelSetting
    â”‚   â””â”€â–º é¢‘é“è®¾ç½®æ‰©å±•ç‚¹
    â”‚
    â”œâ”€â–º EndpointCategory.userInfo
    â”‚   â””â”€â–º ç”¨æˆ·ä¿¡æ¯æ‰©å±•ç‚¹
    â”‚
    â””â”€â–º EndpointCategory.friendApplyDataChange
        â””â”€â–º å¥½å‹ç”³è¯·æ•°æ®å˜åŒ–æ‰©å±•ç‚¹
```

---

## ğŸ“Š çŠ¶æ€ç®¡ç†

```
WKApp (å…¨å±€å•ä¾‹)
    â”‚
    â”œâ”€â–º WKApp.loginInfo        # ç™»å½•ä¿¡æ¯
    â”‚   â””â”€â–º token, uid, name...
    â”‚
    â”œâ”€â–º WKApp.config           # åº”ç”¨é…ç½®
    â”‚   â””â”€â–º themeColor, appVersion...
    â”‚
    â”œâ”€â–º WKApp.dataSource       # æ•°æ®æº
    â”‚   â””â”€â–º å„ç§æ•°æ®æä¾›è€…
    â”‚
    â””â”€â–º WKApp.messageManager  # æ¶ˆæ¯ç®¡ç†
        â””â”€â–º æ¶ˆæ¯å¤„ç†é€»è¾‘
```

---

## ğŸ¯ å¼€å‘æµç¨‹

```
1. ç†è§£éœ€æ±‚
    â”‚
    â–¼
2. ç¡®å®šä¿®æ”¹ä½ç½®
    â”œâ”€â–º å¦‚æœæ˜¯æ–°åŠŸèƒ½ â†’ packages/ ä¸‹åˆ›å»ºæ–°æ¨¡å—
    â”œâ”€â–º å¦‚æœæ˜¯ä¿®æ”¹ç°æœ‰åŠŸèƒ½ â†’ æ‰¾åˆ°å¯¹åº”ç»„ä»¶
    â””â”€â–º å¦‚æœæ˜¯æ·»åŠ é¡µé¢ â†’ apps/web/src/App/index.tsx æ³¨å†Œè·¯ç”±
    â”‚
    â–¼
3. ç¼–å†™ä»£ç 
    â”‚
    â–¼
4. æµ‹è¯•åŠŸèƒ½
    â”‚
    â–¼
5. æäº¤ä»£ç 
```

---

## ğŸ’¡ å…³é”®ç†è§£ç‚¹

1. **Monorepo æ¶æ„**ï¼šå¤šä¸ªåŒ…åœ¨ä¸€ä¸ªä»“åº“ä¸­ï¼Œé€šè¿‡ workspace ç®¡ç†
2. **æ¨¡å—åŒ–è®¾è®¡**ï¼šåŠŸèƒ½æ‹†åˆ†æˆç‹¬ç«‹æ¨¡å—ï¼Œé€šè¿‡æ³¨å†Œæœºåˆ¶ç»„åˆ
3. **WKApp å•ä¾‹**ï¼šå…¨å±€çŠ¶æ€å’ŒåŠŸèƒ½éƒ½é€šè¿‡ WKApp è®¿é—®
4. **è·¯ç”±ç³»ç»Ÿ**ï¼šæ”¯æŒä¸»è·¯ç”±å’Œä¸Šä¸‹æ–‡è·¯ç”±ï¼ˆå·¦å³é¢æ¿ï¼‰
5. **æ‰©å±•ç‚¹ç³»ç»Ÿ**ï¼šé€šè¿‡ Endpoint å®ç°æ¨¡å—é—´é€šä¿¡å’ŒåŠŸèƒ½æ‰©å±•

---

**è®°ä½ï¼šæ¶æ„è™½ç„¶å¤æ‚ï¼Œä½†æ ¸å¿ƒå°±æ˜¯ WKApp + æ¨¡å—ç³»ç»Ÿï¼** ğŸš€

